<!DOCTYPE html>
<html lang="en-US">
<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Domestic direct connection and ad blocking - Trojan-Go Docs</title>
<meta name="description" content="An unidentifiable mechanism that helps you bypass GFW.">
<meta name="generator" content="Hugo 0.108.0">
<link href="https://azadzadeh.github.io/trojan-goindex.xml" rel="alternate" type="application/rss+xml">
<link rel="canonical" href="https://azadzadeh.github.io/trojan-go/en/advance/router/">
<link rel="stylesheet" href="https://azadzadeh.github.io/trojan-go/css/theme.min.css">
<script src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script>
<link rel="stylesheet" href="https://azadzadeh.github.io/trojan-go/css/chroma.min.css">
<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery.easing@1.4.1/jquery.easing.min.js"></script>
<script src="https://azadzadeh.github.io/trojan-go/js/bundle.js"></script><style>
:root {}
</style>
<meta property="og:title" content="Domestic direct connection and ad blocking" />
<meta property="og:description" content="Compatibility Note that Trojan does not support this feature Trojan-Go&rsquo;s built-in routing module can help you implement domestic direct connections, i.e., the client can connect directly to domestic websites without going through a proxy. The routing module can be configured with three policies (bypass, proxy, block) on the client side, and only the block policy can be used on the server side. Here is an example { &#34;run_type&#34;: &#34;client&#34;, &#34;local_addr&#34;:" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://azadzadeh.github.io/trojan-go/en/advance/router/" /><meta property="og:image" content="https://azadzadeh.github.io/trojan-go/images/og-image.png"/><meta property="article:section" content="advance" />

<meta property="og:site_name" content="Trojan-Go Docs" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://azadzadeh.github.io/trojan-go/images/og-image.png"/>

<meta name="twitter:title" content="Domestic direct connection and ad blocking"/>
<meta name="twitter:description" content="Compatibility Note that Trojan does not support this feature Trojan-Go&rsquo;s built-in routing module can help you implement domestic direct connections, i.e., the client can connect directly to domestic websites without going through a proxy. The routing module can be configured with three policies (bypass, proxy, block) on the client side, and only the block policy can be used on the server side. Here is an example { &#34;run_type&#34;: &#34;client&#34;, &#34;local_addr&#34;:"/>
<meta itemprop="name" content="Domestic direct connection and ad blocking">
<meta itemprop="description" content="Compatibility Note that Trojan does not support this feature Trojan-Go&rsquo;s built-in routing module can help you implement domestic direct connections, i.e., the client can connect directly to domestic websites without going through a proxy. The routing module can be configured with three policies (bypass, proxy, block) on the client side, and only the block policy can be used on the server side. Here is an example { &#34;run_type&#34;: &#34;client&#34;, &#34;local_addr&#34;:">

<meta itemprop="wordCount" content="325"><meta itemprop="image" content="https://azadzadeh.github.io/trojan-go/images/og-image.png"/>
<meta itemprop="keywords" content="" /></head>
<body><div class="container"><header>
<h1>Trojan-Go Docs</h1>
<a href="https://github.com/p4gefau1t/trojan-go" class="github"><i class="fab fa-github"></i></a>
<p class="description">An unidentifiable mechanism that helps you bypass GFW.</p>

</header>
<div class="global-menu">
<nav>
<ul>
<li><a href="/trojan-go/en/">English (DeepL)</a></li>
<li><a href="/trojan-go/zh/">Chinese (original)</a></li>
<li><a href="https://github.com/p4gefau1t">GitHub</a></li></ul>
</nav>
</div>
<div class="content-container">
<main><h1>Domestic direct connection and ad blocking</h1>
<div class="panel panel-caution"><div class="panel-header">
<h3>Compatibility</h3>
</div><div class="panel-body">
<p>Note that Trojan does not support this feature</p>
</div>
</div>
<p>Trojan-Go&rsquo;s built-in routing module can help you implement domestic direct connections, i.e., the client can connect directly to domestic websites without going through a proxy.</p>
<p>The routing module can be configured with three policies (<code>bypass</code>, <code>proxy</code>, <code>block</code>) on the client side, and only the <code>block</code> policy can be used on the server side.</p>
<p>Here is an example</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;run_type&#34;</span>: <span style="color:#e6db74">&#34;client&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;local_addr&#34;</span>: <span style="color:#e6db74">&#34;127.0.0.1&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;local_port&#34;</span>: <span style="color:#ae81ff">1080</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;remote_addr&#34;</span>: <span style="color:#e6db74">&#34;your_server&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;remote_port&#34;</span>: <span style="color:#ae81ff">443</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;password&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;your_password&#34;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;ssl&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;sni&#34;</span>: <span style="color:#e6db74">&#34;your-domain-name.com&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;mux&#34;</span> :{
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;enabled&#34;</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;router&#34;</span>:{
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;enabled&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;bypass&#34;</span>: [
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;geoip:cn&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;geoip:private&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;geosite:cn&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;geosite:geolocation-cn&#34;</span>
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;block&#34;</span>: [
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;geosite:category-ads&#34;</span>
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;proxy&#34;</span>: [
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;geosite:geolocation-!cn&#34;</span>
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This configuration file activates the router module, which uses a whitelist mode, and connects directly when matched to an IP/domain name from mainland China or the LAN. If it is the domain name of the advertising operator, it is directly disconnected.</p>
<p>The required databases <code>geoip.dat</code> and <code>geosite.dat</code> are included in the release zip and can be used directly. They come from V2Ray&rsquo;s <a href="https://github.com/v2fly/domain-list-community">domain-list-community</a> and <a href="https://github.com/v2fly/geoip">geoip</a>.</p>
<p>You can specify a certain category of domains using forms like <code>geosite:cn</code>, <code>geosite:geolocation-!cn</code>, <code>geosite:category-ads-all</code>, <code>geosite:bilibili</code>, and all available tags can be found in <a href="https://github.com/v2fly/domain-list-community"> domain-list-community</a> repository of <a href="https://github.com/v2fly/domain-list-community/tree/master/data">data</a> directory. <code>geosite.dat</code> For more detailed usage instructions, refer to <a href="https://www.v2fly.org/config/routing.html#%E9%A2%84%E5%AE%9A%E4%B9%89%E5%9F%9F%E5%90%8D%E5%88%97%E8%A1%A8">V2Ray/Routing#List of predefined domains</a>.</p>
<p>You can specify a certain category of IPs using forms such as <code>geoip:cn</code>, <code>geoip:hk</code>, <code>geoip:us</code>, and <code>geoip:private</code>. <code>geoip:private</code> is a special entry that encompasses intranet IPs and reserved IPs, and the rest of the categories encompass individual country/region IP address segment. Refer to <a href="https://zh.wikipedia.org/wiki/%E5%9C%8B%E5%AE%B6%E5%9C%B0%E5%8D%80%E4%BB%A3%E7%A2%BC">Wikipedia</a> for the country/region codes.</p>
<p>You can also configure your own routing rules. For example, to block all example.com domains and their subdomains, as well as 192.168.1.0/24, add the following rule.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#e6db74">&#34;block&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;domain:example.com&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;cidr:192.168.1.0/24&#34;</span>
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p>The supported formats are</p>
<ul>
<li>
<p>&ldquo;domain:&rdquo;, subdomain match</p>
</li>
<li>
<p>&ldquo;full:&rdquo;, full domain match</p>
</li>
<li>
<p>&ldquo;regexp:&rdquo;, regular expression match</p>
</li>
<li>
<p>&ldquo;cidr:&rdquo;, CIDR match</p>
</li>
</ul>
<p>For more details, please refer to the section &ldquo;The Complete Configuration File&rdquo;.</p>
<div class="edit-meta">

<br><a href="https://github.com/p4gefau1t/trojan-go/docs/edit/master/content/advance/router.md" class="edit-page"><i class="fas fa-pen-square"></i> Edit on GitHub</a></div><nav class="pagination"><a class="nav nav-prev" href="https://azadzadeh.github.io/trojan-go/en/advance/websocket/" title="CDN forwarding and resisting man-in-the-middle attacks using Websocket"><i class="fas fa-arrow-left" aria-hidden="true"></i> Prev - CDN forwarding and resisting man-in-the-middle attacks using Websocket</a>
<a class="nav nav-next" href="https://azadzadeh.github.io/trojan-go/en/advance/forward/" title="Tunnels and reverse proxies">Next - Tunnels and reverse proxies <i class="fas fa-arrow-right" aria-hidden="true"></i></a>
</nav><footer><p class="powered">Powered by <a href="https://gohugo.io">Hugo</a>. Theme by <a href="https://themes.gohugo.io/hugo-theme-techdoc/">TechDoc</a>. Designed by <a href="https://github.com/thingsym/hugo-theme-techdoc">Thingsym</a>.</p>
</footer>
</main><div class="sidebar">

<nav class="open-menu">
<ul>
<li class=""><a href="https://azadzadeh.github.io/trojan-go">Home</a></li>

<li class=""><a href="https://azadzadeh.github.io/trojan-go/en/basic/">Basic Configuration</a>
  
<ul class="sub-menu">
<li class=""><a href="https://azadzadeh.github.io/trojan-go/en/basic/trojan/">Trojan fundamentals</a></li>
<li class=""><a href="https://azadzadeh.github.io/trojan-go/en/basic/config/">Configuring Trojan-Go correctly</a></li>
<li class=""><a href="https://azadzadeh.github.io/trojan-go/en/basic/full-config/">Full configuration file</a></li>
</ul>
  
</li>

<li class="parent"><a href="https://azadzadeh.github.io/trojan-go/en/advance/">Advanced Configuration</a>
  
<ul class="sub-menu">
<li class=""><a href="https://azadzadeh.github.io/trojan-go/en/advance/mux/">Enabling multiplexing to improve network concurrency performance</a></li>
<li class=""><a href="https://azadzadeh.github.io/trojan-go/en/advance/websocket/">CDN forwarding and resisting man-in-the-middle attacks using Websocket</a></li>
<li class="active"><a href="https://azadzadeh.github.io/trojan-go/en/advance/router/">Domestic direct connection and ad blocking</a></li>
<li class=""><a href="https://azadzadeh.github.io/trojan-go/en/advance/forward/">Tunnels and reverse proxies</a></li>
<li class=""><a href="https://azadzadeh.github.io/trojan-go/en/advance/nginx-relay/">A multi-path split relaying scheme based on SNI proxy</a></li>
<li class=""><a href="https://azadzadeh.github.io/trojan-go/en/advance/plugin/">Using Shadowsocks Plugin/Pluggable Transport Layer</a></li>
<li class=""><a href="https://azadzadeh.github.io/trojan-go/en/advance/customize-protocol-stack/">Custom Protocol Stack</a></li>
<li class=""><a href="https://azadzadeh.github.io/trojan-go/en/advance/aead/">Secondary encryption with Shadowsocks AEAD</a></li>
<li class=""><a href="https://azadzadeh.github.io/trojan-go/en/advance/api/">Managing users dynamically using the API</a></li>
<li class=""><a href="https://azadzadeh.github.io/trojan-go/en/advance/nat/">Transparent Proxy</a></li>
</ul>
  
</li>

<li class=""><a href="https://azadzadeh.github.io/trojan-go/en/developer/">Implementation details and development guidelines</a>
  
<ul class="sub-menu">
<li class=""><a href="https://azadzadeh.github.io/trojan-go/en/developer/overview/">Basic introduction</a></li>
<li class=""><a href="https://azadzadeh.github.io/trojan-go/en/developer/build/">Compiling and customizing Trojan-Go</a></li>
<li class=""><a href="https://azadzadeh.github.io/trojan-go/en/developer/trojan/">Trojan Protocol</a></li>
<li class=""><a href="https://azadzadeh.github.io/trojan-go/en/developer/mux/">Multiplexing</a></li>
<li class=""><a href="https://azadzadeh.github.io/trojan-go/en/developer/websocket/">Websocket</a></li>
<li class=""><a href="https://azadzadeh.github.io/trojan-go/en/developer/simplesocks/">SimpleSocks Protocol</a></li>
<li class=""><a href="https://azadzadeh.github.io/trojan-go/en/developer/api/">API Development</a></li>
<li class=""><a href="https://azadzadeh.github.io/trojan-go/en/developer/plugin/">Pluggable transport layer plug-in development</a></li>
<li class=""><a href="https://azadzadeh.github.io/trojan-go/en/developer/url/">URL scheme (draft)</a></li>
</ul>
  
</li>
</ul>
</nav>



<div class="sidebar-footer"></div>
</div>
</div><a href="#" id="backtothetop-fixed" class="backtothetop"
 data-backtothetop-duration="600"
 data-backtothetop-easing="easeOutQuart"
 data-backtothetop-fixed-fadeIn="1000"
 data-backtothetop-fixed-fadeOut="1000"
 data-backtothetop-fixed-bottom="10"
 data-backtothetop-fixed-right="20">
<span class="fa-layers fa-fw">
<i class="fas fa-circle"></i>
<i class="fas fa-arrow-circle-up"></i>
</span></a>
</div>
</body>
</html>
