<!DOCTYPE html>
<html lang="en-US">
<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Configuring Trojan-Go correctly - Trojan-Go Docs</title>
<meta name="description" content="An unidentifiable mechanism that helps you bypass GFW.">
<meta name="generator" content="Hugo 0.108.0">
<link href="https://azadzadeh.github.io/trojan-goindex.xml" rel="alternate" type="application/rss+xml">
<link rel="canonical" href="https://azadzadeh.github.io/trojan-go/en/basic/config/">
<link rel="stylesheet" href="https://azadzadeh.github.io/trojan-go/css/theme.min.css">
<script src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script>
<link rel="stylesheet" href="https://azadzadeh.github.io/trojan-go/css/chroma.min.css">
<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery.easing@1.4.1/jquery.easing.min.js"></script>
<script src="https://azadzadeh.github.io/trojan-go/js/bundle.js"></script><style>
:root {}
</style>
<meta property="og:title" content="Configuring Trojan-Go correctly" />
<meta property="og:description" content="The following section will describe how to properly configure Trojan-Go to completely hide your proxy node features.
Before you start, you need
A server that is not blocked by GFW
A domain name, you can use a free domain name service such as .tk
Trojan-Go, which can be downloaded from the release page
Certificates and keys, which can be issued for free from agencies such as letsencrypt
Server-side configuration Our goal is to make your server behave the same as a normal HTTPS site." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://azadzadeh.github.io/trojan-go/en/basic/config/" /><meta property="og:image" content="https://azadzadeh.github.io/trojan-go/images/og-image.png"/><meta property="article:section" content="basic" />

<meta property="og:site_name" content="Trojan-Go Docs" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://azadzadeh.github.io/trojan-go/images/og-image.png"/>

<meta name="twitter:title" content="Configuring Trojan-Go correctly"/>
<meta name="twitter:description" content="The following section will describe how to properly configure Trojan-Go to completely hide your proxy node features.
Before you start, you need
A server that is not blocked by GFW
A domain name, you can use a free domain name service such as .tk
Trojan-Go, which can be downloaded from the release page
Certificates and keys, which can be issued for free from agencies such as letsencrypt
Server-side configuration Our goal is to make your server behave the same as a normal HTTPS site."/>
<meta itemprop="name" content="Configuring Trojan-Go correctly">
<meta itemprop="description" content="The following section will describe how to properly configure Trojan-Go to completely hide your proxy node features.
Before you start, you need
A server that is not blocked by GFW
A domain name, you can use a free domain name service such as .tk
Trojan-Go, which can be downloaded from the release page
Certificates and keys, which can be issued for free from agencies such as letsencrypt
Server-side configuration Our goal is to make your server behave the same as a normal HTTPS site.">

<meta itemprop="wordCount" content="868"><meta itemprop="image" content="https://azadzadeh.github.io/trojan-go/images/og-image.png"/>
<meta itemprop="keywords" content="" /></head>
<body><div class="container"><header>
<h1>Trojan-Go Docs</h1>
<a href="https://github.com/p4gefau1t/trojan-go" class="github"><i class="fab fa-github"></i></a>
<p class="description">An unidentifiable mechanism that helps you bypass GFW.</p>

</header>
<div class="global-menu">
<nav>
<ul>
<li><a href="/trojan-go/en/">English (DeepL)</a></li>
<li><a href="/trojan-go/zh/">Chinese (original)</a></li>
<li><a href="https://github.com/p4gefau1t">GitHub</a></li></ul>
</nav>
</div>
<div class="content-container">
<main><h1>Configuring Trojan-Go correctly</h1>
<p>The following section will describe how to properly configure Trojan-Go to completely hide your proxy node features.</p>
<p>Before you start, you need</p>
<ul>
<li>
<p>A server that is not blocked by GFW</p>
</li>
<li>
<p>A domain name, you can use a free domain name service such as .tk</p>
</li>
<li>
<p>Trojan-Go, which can be downloaded from the release page</p>
</li>
<li>
<p>Certificates and keys, which can be issued for free from agencies such as letsencrypt</p>
</li>
</ul>
<h3 id="server-side-configuration">Server-side configuration</h3>
<p>Our goal is to make your server behave the same as a normal HTTPS site.</p>
<p>First you need an HTTP server, you can configure a local HTTP server using nginx, apache, caddy etc. or you can use someone else&rsquo;s HTTP server. the role of the HTTP server is to show a fully functional web page to GFW when it actively detects it.</p>
<p><strong>You need to specify the address of this HTTP server in <code>remote_addr</code> and <code>remote_port</code>. The <code>remote_addr</code> can be either an IP or a domain name. Trojan-Go will test if this HTTP server is working properly, and if not, Trojan-Go will refuse to start it.</strong></p>
<p>The following is a more secure server configuration server.json, which requires you to configure an HTTP service on local port 80 (if necessary, you can also use another HTTP server for your website, such as &ldquo;remote_addr&rdquo;: &ldquo;example.com&rdquo;) and an HTTPS service on port 1234, or a static HTTP service that displays &ldquo;400 Bad Request&rdquo; static HTTP web service. (Optionally, you can delete the <code>fallback_port</code> field and skip this step)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;run_type&#34;</span>: <span style="color:#e6db74">&#34;server&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;local_addr&#34;</span>: <span style="color:#e6db74">&#34;0.0.0.0&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;local_port&#34;</span>: <span style="color:#ae81ff">443</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;remote_addr&#34;</span>: <span style="color:#e6db74">&#34;127.0.0.1&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;remote_port&#34;</span>: <span style="color:#ae81ff">80</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;password&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;your_awesome_password&#34;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;ssl&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;cert&#34;</span>: <span style="color:#e6db74">&#34;server.crt&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;key&#34;</span>: <span style="color:#e6db74">&#34;server.key&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;fallback_port&#34;</span>: <span style="color:#ae81ff">1234</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This configuration file causes Trojan-Go to listen on port 443 on all IP addresses of the server (0.0.0.0), using server.crt and server.key as the certificate and key for the TLS handshake, respectively. You should use as complex a password as possible, while making sure that the client and server <code>password</code> are the same. Note that <strong>Trojan-Go will check if your HTTP server <code>http://remote_addr:remote_port</code> is working properly. If your HTTP server is not working properly, Trojan-Go will refuse to start it.</strong></p>
<p>When a client tries to connect to Trojan-Go&rsquo;s listening port, the following happens.</p>
<ul>
<li>
<p>If the TLS handshake is successful and the contents of the TLS are detected as non-Trojan protocol (possibly an HTTP request, or an active probe from GFW). Trojan-Go proxies the TLS connection to the HTTP service on local 127.0.0.1:80. At this point it appears to the remote end that the Trojan-Go service is an HTTPS site.</p>
</li>
<li>
<p>If the TLS handshake is successful and is confirmed to be a Trojan protocol header with the correct password in it, then the server will parse the request from the client and proxy it, otherwise it is handled in the same way as in the previous step.</p>
</li>
<li>
<p>If the TLS handshake fails, the other party is using a protocol other than TLS to connect. At this point Trojan-Go proxies the TCP connection to an HTTPS service (or HTTP service) running on local 127.0.0.1:1234, returning an HTTP page displaying 400 Bad Reqeust. The <code>fallback_port</code> is an optional option, if not filled in, Trojan-Go will simply terminate the connection. Although it is optional, it is highly recommended to fill it in.</p>
</li>
</ul>
<p>You can verify this by visiting your domain <code>https://your-domain-name.com</code> using your browser. If it works properly, your browser will display a normal HTTPS-protected web page with the same content as the page on the server&rsquo;s native port 80. You can also use <code>http://your-domain-name.com:443</code> to verify that <code>fallback_port</code> is working properly.</p>
<p>In fact, you can even use Trojan-Go as your HTTPS server to serve HTTPS to your website. Visitors can browse your site through Trojan-Go normally, without affecting each other and the proxy traffic. Note, however, that you should not build services with high real-time requirements at <code>remote_port</code> and <code>fallback_port</code>. Trojan-Go will intentionally add a small delay when it identifies non-Trojan protocol traffic to resist GFW&rsquo;s time-based detection.</p>
<p>Once configured, you can use the</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>./trojan-go -config ./server.json
</span></span></code></pre></div><p>Start the server.</p>
<h3 id="client-configuration">Client configuration</h3>
<p>The corresponding client configuration client.json</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;run_type&#34;</span>: <span style="color:#e6db74">&#34;client&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;local_addr&#34;</span>: <span style="color:#e6db74">&#34;127.0.0.1&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;local_port&#34;</span>: <span style="color:#ae81ff">1080</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;remote_addr&#34;</span>: <span style="color:#e6db74">&#34;your_awesome_server&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;remote_port&#34;</span>: <span style="color:#ae81ff">443</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;password&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;your_awesome_password&#34;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;ssl&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;sni&#34;</span>: <span style="color:#e6db74">&#34;your-domain-name.com&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This client configuration enables Trojan-Go to open a socks5/http proxy listening on local port 1080 (auto-aware) with a remote server of your_awesome_server:443, your_awesome_server can be an IP or domain name.</p>
<p>If you fill in <code>remote_addr</code> with a domain name, <code>sni</code> can be omitted. If you fill in <code>remote_addr</code> with the IP address, the <code>sni</code> field should be filled in with the corresponding domain name of the certificate you applied for, or the Common Name of the certificate you issued yourself, and it must be consistent. Note that the <code>sni</code> field is currently in the TLS protocol <strong>explicit transmission</strong> (the purpose is to make the server provide the corresponding certificate). GFW has been proven to have SNI detection and blocking capabilities, so do not fill in similar <code>google.com</code> and other domains that have been blocked, otherwise it is likely to cause your server to be blocked as well.</p>
<p>After the configuration is done, you can use</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>./trojan-go -config ./client.json
</span></span></code></pre></div><p>Start the client.</p>
<p>More information about configuration files can be found in the left navigation bar.</p>
<div class="edit-meta">

<br><a href="https://github.com/p4gefau1t/trojan-go/docs/edit/master/content/basic/config.md" class="edit-page"><i class="fas fa-pen-square"></i> Edit on GitHub</a></div><nav class="pagination"><a class="nav nav-prev" href="https://azadzadeh.github.io/trojan-go/en/basic/trojan/" title="Trojan fundamentals"><i class="fas fa-arrow-left" aria-hidden="true"></i> Prev - Trojan fundamentals</a>
<a class="nav nav-next" href="https://azadzadeh.github.io/trojan-go/en/basic/full-config/" title="Full configuration file">Next - Full configuration file <i class="fas fa-arrow-right" aria-hidden="true"></i></a>
</nav><footer><p class="powered">Powered by <a href="https://gohugo.io">Hugo</a>. Theme by <a href="https://themes.gohugo.io/hugo-theme-techdoc/">TechDoc</a>. Designed by <a href="https://github.com/thingsym/hugo-theme-techdoc">Thingsym</a>.</p>
</footer>
</main><div class="sidebar">

<nav class="open-menu">
<ul>
<li class=""><a href="https://azadzadeh.github.io/trojan-go">Home</a></li>

<li class="parent"><a href="https://azadzadeh.github.io/trojan-go/en/basic/">Basic Configuration</a>
  
<ul class="sub-menu">
<li class=""><a href="https://azadzadeh.github.io/trojan-go/en/basic/trojan/">Trojan fundamentals</a></li>
<li class="active"><a href="https://azadzadeh.github.io/trojan-go/en/basic/config/">Configuring Trojan-Go correctly</a></li>
<li class=""><a href="https://azadzadeh.github.io/trojan-go/en/basic/full-config/">Full configuration file</a></li>
</ul>
  
</li>

<li class=""><a href="https://azadzadeh.github.io/trojan-go/en/advance/">Advanced Configuration</a>
  
<ul class="sub-menu">
<li class=""><a href="https://azadzadeh.github.io/trojan-go/en/advance/mux/">Enabling multiplexing to improve network concurrency performance</a></li>
<li class=""><a href="https://azadzadeh.github.io/trojan-go/en/advance/websocket/">CDN forwarding and resisting man-in-the-middle attacks using Websocket</a></li>
<li class=""><a href="https://azadzadeh.github.io/trojan-go/en/advance/router/">Domestic direct connection and ad blocking</a></li>
<li class=""><a href="https://azadzadeh.github.io/trojan-go/en/advance/forward/">Tunnels and reverse proxies</a></li>
<li class=""><a href="https://azadzadeh.github.io/trojan-go/en/advance/nginx-relay/">A multi-path split relaying scheme based on SNI proxy</a></li>
<li class=""><a href="https://azadzadeh.github.io/trojan-go/en/advance/plugin/">Using Shadowsocks Plugin/Pluggable Transport Layer</a></li>
<li class=""><a href="https://azadzadeh.github.io/trojan-go/en/advance/customize-protocol-stack/">Custom Protocol Stack</a></li>
<li class=""><a href="https://azadzadeh.github.io/trojan-go/en/advance/aead/">Secondary encryption with Shadowsocks AEAD</a></li>
<li class=""><a href="https://azadzadeh.github.io/trojan-go/en/advance/api/">Managing users dynamically using the API</a></li>
<li class=""><a href="https://azadzadeh.github.io/trojan-go/en/advance/nat/">Transparent Proxy</a></li>
</ul>
  
</li>

<li class=""><a href="https://azadzadeh.github.io/trojan-go/en/developer/">Implementation details and development guidelines</a>
  
<ul class="sub-menu">
<li class=""><a href="https://azadzadeh.github.io/trojan-go/en/developer/overview/">Basic introduction</a></li>
<li class=""><a href="https://azadzadeh.github.io/trojan-go/en/developer/build/">Compiling and customizing Trojan-Go</a></li>
<li class=""><a href="https://azadzadeh.github.io/trojan-go/en/developer/trojan/">Trojan Protocol</a></li>
<li class=""><a href="https://azadzadeh.github.io/trojan-go/en/developer/mux/">Multiplexing</a></li>
<li class=""><a href="https://azadzadeh.github.io/trojan-go/en/developer/websocket/">Websocket</a></li>
<li class=""><a href="https://azadzadeh.github.io/trojan-go/en/developer/simplesocks/">SimpleSocks Protocol</a></li>
<li class=""><a href="https://azadzadeh.github.io/trojan-go/en/developer/api/">API Development</a></li>
<li class=""><a href="https://azadzadeh.github.io/trojan-go/en/developer/plugin/">Pluggable transport layer plug-in development</a></li>
<li class=""><a href="https://azadzadeh.github.io/trojan-go/en/developer/url/">URL scheme (draft)</a></li>
</ul>
  
</li>
</ul>
</nav>



<div class="sidebar-footer"></div>
</div>
</div><a href="#" id="backtothetop-fixed" class="backtothetop"
 data-backtothetop-duration="600"
 data-backtothetop-easing="easeOutQuart"
 data-backtothetop-fixed-fadeIn="1000"
 data-backtothetop-fixed-fadeOut="1000"
 data-backtothetop-fixed-bottom="10"
 data-backtothetop-fixed-right="20">
<span class="fa-layers fa-fw">
<i class="fas fa-circle"></i>
<i class="fas fa-arrow-circle-up"></i>
</span></a>
</div>
</body>
</html>
